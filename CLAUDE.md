# BBQCopilot - AI-Powered BBQ Recipe & Cook Planning App

## Project Overview

BBQCopilot is a personalized BBQ recipe application that generates equipment-specific recipes, prep guides, and cook timelines based on the user's actual grills and accessories. The app solves the frustration of searching for generic recipes that don't account for the significant differences between grill types (Kamado Joe vs Weber Genesis vs offset smoker, etc.).

## Tech Stack

- **Frontend:** Expo + React Native with Expo Router (web, iOS, Android from single codebase)
- **Styling:** NativeWind (Tailwind CSS for React Native)
- **Backend/Auth:** Supabase (PostgreSQL, Auth with Google/Email, Row Level Security)
- **AI:** Anthropic Claude API
  - `claude-3-haiku-20240307` for clarifying questions, input parsing (cheapest)
  - `claude-3-5-haiku-20241022` for recipe generation (best cost/quality balance)
- **State Management:** React Context + React Query (TanStack Query)

## Development Guidelines

### Commit Practices
- **Commit frequently** - After completing each logical unit of work
- **Omit signature** - Do not include "Generated by Claude Code" or similar signatures in commits
- **Use conventional commits:** `feat:`, `fix:`, `refactor:`, `style:`, `docs:`, `test:`

### Code Style
- Use TypeScript for all files
- Prefer functional components with hooks
- Use async/await over .then() chains
- Extract reusable logic into custom hooks
- Keep components under 150 lines; extract sub-components when larger

### File Structure
```
/app                    # Expo Router pages
  /(auth)               # Auth screens (login, register)
  /(tabs)               # Main tab navigation
    /index.tsx          # Home/Dashboard
    /cook.tsx           # New cook flow
    /equipment.tsx      # Equipment management
    /history.tsx        # Cook history
  /_layout.tsx          # Root layout
/components             # Reusable UI components
  /ui                   # Base components (Button, Input, Card, etc.)
  /equipment            # Equipment-related components
  /recipe               # Recipe display components
  /cook                 # Cook planning components
/hooks                  # Custom React hooks
/lib                    # Utilities, API clients, constants
  /supabase.ts          # Supabase client
  /anthropic.ts         # Claude API wrapper
  /types.ts             # TypeScript types
/contexts               # React Context providers
/assets                 # Images, fonts
```

## Design System

### Brand Identity
BBQCopilot evokes the warmth of fire, the craft of smoking, and the satisfaction of a perfect cook. The design should feel premium but approachableâ€”like a well-worn leather apron at a high-end steakhouse. The "Copilot" name signals AI assistance, implying you're working alongside the app as your trusted BBQ partner.

### Color Palette
```
Primary:
- Ember Red: #C41E3A (primary actions, accents)
- Char Black: #1A1A1A (backgrounds, text)
- Smoke Gray: #4A4A4A (secondary text)

Secondary:
- Ash White: #F5F5F0 (light backgrounds, cards)
- Copper Glow: #B87333 (highlights, success states)
- Mesquite Brown: #5D3A1A (warm accents)

Status:
- Success: #2D5A27 (forest green - cook complete)
- Warning: #D4A574 (amber - attention needed)
- Error: #8B2635 (deep red - issues)
```

### Typography
- **Display/Headers:** "Playfair Display" or "Libre Baskerville" (editorial, classic BBQ feel)
- **Body:** "Source Sans Pro" or "DM Sans" (clean, readable)
- **Monospace (timers/temps):** "JetBrains Mono" or "IBM Plex Mono"

### Design Principles
1. **Warmth over sterility** - Subtle textures, warm tones, organic shapes
2. **Functional beauty** - Every element serves a purpose
3. **Tactile feedback** - Satisfying interactions, subtle animations
4. **Dark mode first** - BBQ happens outdoors; screens should be readable in sun
5. **Information hierarchy** - Critical cook info (temps, times) always prominent

### UI Patterns
- Cards with subtle shadows and rounded corners (12-16px radius)
- Gradient backgrounds using ember/copper tones
- Icon system: Outlined style, 24px base, with filled variants for active states
- Generous whitespace; don't crowd the interface
- Bottom sheet modals for mobile-first interactions
- Progress indicators for long processes (recipe generation, cook progress)

### Animation Guidelines
- Use spring animations for interactive elements
- Stagger list item animations on mount
- Subtle scale transforms on press (0.97-0.99)
- Page transitions: slide + fade combination

## AI Integration Architecture

### Model Selection Strategy
```typescript
// Use Haiku 3 (claude-3-haiku-20240307) for:
- Parsing user input ("I want to smoke a brisket")
- Generating clarifying questions
- Simple lookups and validations
- Quick responses during conversation

// Use Haiku 3.5 (claude-3-5-haiku-20241022) for:
- Full recipe generation
- Detailed cook timelines
- Equipment-specific adaptations
- Complex multi-protein planning

// Note: If recipe quality needs improvement, upgrade to:
// - Haiku 4.5 (claude-haiku-4-5-20251001) - 25% more expensive
// - Sonnet 4.5 (claude-sonnet-4-5-20250929) - 4x more expensive, highest quality
```

### Prompt Structure
Always include in recipe generation prompts:
1. User's equipment profile (grill type, accessories)
2. Meat selection and quantity
3. Time constraints
4. Skill level
5. Flavor preferences (if provided)

### Cost Optimization
- Stream responses to improve perceived performance
- Cache equipment profiles client-side
- Batch clarifying questions (ask multiple in one call)
- Future: Implement recipe caching for common combinations

### Usage Limits & Rate Limiting
To protect against runaway API costs, the app enforces usage limits:

| Tier | Recipes/Month | Recipes/Day |
|------|---------------|-------------|
| Free | 15 | 3 |
| Pro (future) | 500 | 20 |
| Unlimited (future) | Unlimited | Unlimited |

Implementation:
- Track usage in `user_usage` table (per-month)
- Check limits before API calls in Edge Function
- Return 429 status with reset date when exceeded
- Show friendly UI banner when approaching/hitting limit
- Set Anthropic spend limit ($50/mo initially) as safety net

## Database Schema (Supabase)

### Core Tables
```sql
-- Users (handled by Supabase Auth)

-- Equipment Profiles
profiles (
  id uuid PRIMARY KEY,
  user_id uuid REFERENCES auth.users,
  created_at timestamp
)

grills (
  id uuid PRIMARY KEY,
  profile_id uuid REFERENCES profiles,
  name text,  -- "My Big Joe"
  brand text, -- "Kamado Joe"
  model text, -- "Big Joe III"
  type text,  -- "kamado" | "gas" | "charcoal" | "pellet" | "offset"
  created_at timestamp
)

accessories (
  id uuid PRIMARY KEY,
  grill_id uuid REFERENCES grills,
  name text,  -- "Joetisserie"
  type text,  -- "rotisserie" | "griddle" | "pizza_stone" | "soapstone" | etc.
  created_at timestamp
)

-- Recipes & Cooks
recipes (
  id uuid PRIMARY KEY,
  user_id uuid REFERENCES auth.users,
  title text,
  protein text,
  grill_id uuid REFERENCES grills,
  recipe_data jsonb,  -- Full AI-generated recipe
  created_at timestamp
)

cook_logs (
  id uuid PRIMARY KEY,
  recipe_id uuid REFERENCES recipes,
  cooked_at timestamp,
  notes text,
  rating integer,
  photos text[],  -- URLs
  created_at timestamp
)

favorites (
  id uuid PRIMARY KEY,
  user_id uuid REFERENCES auth.users,
  recipe_id uuid REFERENCES recipes,
  created_at timestamp
)
```

## Key User Flows

### 1. Onboarding
1. Sign up (Google or email)
2. Add first grill (guided selection)
3. Add accessories for that grill
4. Optional: Add additional grills

### 2. Generate Recipe
1. Select "New Cook" 
2. Choose grill (if multiple)
3. Enter what to cook (natural language: "brisket for 8 people")
4. AI asks clarifying questions (skill level, time, flavor preferences)
5. AI generates complete recipe with timeline
6. User can save or start cook

### 3. During Cook (Timeline View)
1. View step-by-step timeline
2. Each step shows: time, action, details
3. Mark steps complete as you go
4. Optional: Add notes during cook
5. Save to cook log when complete

## Environment Variables

```env
EXPO_PUBLIC_SUPABASE_URL=
EXPO_PUBLIC_SUPABASE_ANON_KEY=
ANTHROPIC_API_KEY=  # Server-side only (Supabase Edge Function)
```

## API Routes (Supabase Edge Functions)

### `/functions/generate-recipe`
- Accepts: equipment profile, cook request, conversation history
- Returns: Streamed recipe response
- Auth: Required (uses user's equipment data)

### `/functions/ask-clarification`
- Accepts: user input, context
- Returns: Clarifying questions (Haiku)
- Auth: Required

## Testing Strategy

- Unit tests for utility functions (Jest)
- Component tests with React Native Testing Library
- E2E tests with Maestro (mobile) and Playwright (web)
- Test recipe generation prompts manually before deployment

## Performance Targets

- App launch to interactive: < 2s
- Recipe generation start (streaming): < 1s
- Smooth 60fps animations
- Offline-capable for viewing saved recipes

## Accessibility

- Minimum touch targets: 44x44px
- Color contrast: WCAG AA minimum
- Screen reader support for all interactive elements
- Reduce motion option for animations

## Deployment

### Hosting
- **Web**: Vercel (free tier to start)
- **Backend/Auth/DB**: Supabase (free tier to start)
- **AI API**: Anthropic Claude (pay-per-use)
- **Mobile**: Apple App Store ($99/year), Google Play ($25 one-time)

### Estimated Monthly Costs (Low Traffic)
| Users | Recipes/month | Estimated Cost |
|-------|---------------|----------------|
| 50-100 | 200 | ~$3/mo |
| 500 | 1,000 | ~$11/mo |
| 2,000+ | 5,000 | ~$55/mo |

*Costs based on Haiku 3 + Haiku 3.5 model configuration (~$0.01/recipe)*

See `DEPLOYMENT.md` for detailed setup instructions.

## Initial Prompt for Claude Code

When starting development, use this prompt:

```
I'm building BBQCopilot, a BBQ recipe app. Please read CLAUDE.md, TASKS.md, and TECHNICAL_SPEC.md to understand the project. Start with Phase 1.1 (Project Setup & Configuration). Commit frequently and omit any Claude Code signatures from commits.
```
